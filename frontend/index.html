<!DOCTYPE html>
<html data-theme="light">
    <head>
        <!-- External libraries -->
        <script
            defer
            src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
        ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pocketbase/0.12.0/pocketbase.umd.js"></script>

        <!-- Application scripts -->
        <script src="/static/utils.js"></script>
        <script src="/static/pb.js"></script>
        <script src="/static/flask_api.js"></script>
        <script src="/static/pb_api.js"></script>
        <link
            rel="stylesheet"
            href="https://unpkg.com/@picocss/pico@1.*/css/pico.min.css"
        />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body x-init="console.log('start alpinejs')">
        <main
            x-data="{
                rok: '2022',
                budget: {},
                expenses: {},
                filtr: '',
                form_data_placeholder: get_form_data_placeholder(),
                form_data: get_form_data_placeholder(),
                vysledky: vypocet_placeholders(),
                extra_investice: [],
                status: 'ok',
                is_admin: false,
                is_logged: false,
                client: {},
                zaznamy: [],
            }"
            x-init="
                $watch('form_data', async (f) => {
                    status = 'loading';
                    var res = await calculate_dane(rok, f);
                    if (res == 'error')
                      status = 'error';
                    else {
                       vysledky = res;
                       status = 'ok';
                    }
                    console.log(vysledky);
                });
                $watch('rok', async (f) => {
                    status = 'loading';
                    var res = await calculate_dane(rok, f);
                    if (res == 'error')
                      status = 'error';
                    else {
                       vysledky = res;
                       status = 'ok';
                    }
                    console.log(vysledky);
                });
                vysledky = await calculate_dane(rok, form_data);
                client = pb_client();
            "
            x-effect="
                budget = (await get_income_data(rok));
                expenses = (await get_expense_data(rok));
                form_data_placeholder = (await get_form_data());
                is_logged = window.localStorage.getItem('pocketbase_auth') !== null;

                if (is_logged && window.localStorage.getItem('pocketbase_auth').token === '') {
                    pb_logout(client);
                };

                is_admin = window.localStorage.getItem('pb_admin') !== null;
                if (is_logged) {
                    console.log(client.authStore.model.id);
                    extra_investice = await client.collection('user_investments').getFullList(200, {
                        sort: '-created',
                        filter: get_user_query(client),
                    });
                }
                console.log(extra_investice);
         "
        >
            <section class="user_buttons">
                <a role="button" href="/login" x-show="!is_logged">Login</a>
                <a role="button" href="/admin" x-show="is_logged && is_admin"
                    >Admin</a
                >
                <a
                    role="button"
                    href="#"
                    x-show="is_logged"
                    x-on:click.prevent="pb_logout(client); is_logged = false;"
                    >Logout</a
                >
            </section>
            <h1 class="nadpis">
                Kalkulačka podílu na státním rozpočtu a výdajů
            </h1>
            <section class="vyber-rok-container">
            <div class="vyber-rok" x-data="{ roky: [] }" x-init="roky = await resolve_valid_years(pb_client()); console.log(roky);">
                <template x-for="select_rok in roky">
                    <div>
                    <input
                        x-model="rok"
                        type="radio"
                        :value="select_rok"
                        :id="'rok' + select_rok"
                    /><label :for="'rok' + select_rok" x-text="select_rok"></label>
                    </div>
                </template>
            </div>
            </section>

            <section class="instrukce-kontejner">
                <article class="instrukce">
                    <details>
                        <summary><h4>Instrukce</h4></summary>
                        <p>
                            Tato webová kalkulačka slouží k výpočtu částky,
                            jakou se podílíte na státním rozpočtu České
                            republiky skrze daně, které povinně odvádíte.
                        </p>
                        <p>
                            Kalkulačka přijme Vámi zadané údaje a podle nich
                            vypočítá částku, kterou za vybraný rok odvedete do
                            státního rozpočtu. Rok, pro který chcete údaje
                            počítat, zaklikněte v sekci nad instrukcemi. Do
                            políček formuláře vždy uveďte průměrnou měsíční
                            hodnotu. Některá pole jsou předvyplněná hodnotami,
                            které odpovídají průměrnému občanovi. Pro přesnější
                            výpočet však pole vyplňte. Kalkulačka je
                            interaktivní, takže mění své výpočty při každé změně
                            údajů nebo vybraného roku.<br />
                        </p>
                        <p>
                            Po levé straně se Vám vedle obecných údajů o
                            státních příjmech za vybraný rok zobrazí, skrze jaké
                            daně jste peníze do rozpočtu odvedli, a po pravé
                            straně se Vám vedle obecných údajů o státních
                            výdajích za vybraný rok zobrazí, na jaké výdaje stát
                            peníze distribuoval. V sekci pod formulářem pak
                            naleznete plánované státní investice vycházející z
                            národního investičního plánu. U těchto investic se
                            Vám zobrazí, kolik procent z celkové částky určené k
                            investicím ve vybraném roce by tato konkrétní
                            investice tvořila, pokud by všechny její náklady
                            měly být uhrazené ve vybraném roce. V políčku vedle
                            se Vám zobrazí částka, která by na investici
                            putovala z Vámi odvedených daní, kdyby se investice
                            realizovala a uhradila pouze v roce, pro který
                            počítáte svůj podíl na rozpočtu. Je možné, že výše
                            investice bude vyšší než vyčleněná celková částka na
                            investice za daný rok, a tak se Vám zobrazí údaje,
                            které budou převyšovat částku, která z Vámi
                            odvedených peněz měla zamířit na investice.<br />
                        </p>
                        <p>
                            V rámci aplikace je možné přidávat do seznamu vlastní investice, pro které Vám kalkulačka automaticky vypočítá podíl na investicích a Váš hypotetický podíl. Pro přidání vlastní investice je nutné si založit účet. Na začátku stránky vpravo nahoře klikněte na tlačítko Login a poté si vytvořte vlastní účet. S účtem se přihlašte a ve formuláři nad investicemi si budete moci vytvořit vlastní investice, které se uloží do databáze. Investice je pak také možné smazat tlačítkem odebrat. V seznamu se Vám Vaše investice budou vždy zobrazovat, pokud budete přihlášení.<br />
                        </p>
                        <p>
                            <strong
                                >Hodnoty vypočítané kalkulačkou jsou pouze
                                orientační!</strong
                            >
                        </p>
                    </details>
                </article>
            </section>
            <section class="status-kontejner">
                <template x-if="status == 'ok'">
                    <p class="ok-status">✓ Vypočteno</p>
                </template>
                <template x-if="status == 'loading'">
                    <p class="loading-status" aria-busy="true">
                        Probíhá výpočet
                    </p>
                </template>
                <template x-if="status == 'error'">
                    <p class="error-status">
                        ❌ Chybný vstup: zadávejte pouze čísla
                    </p>
                </template>
            </section>
            <section class="main" x-data>
                <article class="calc-form form">
                    <form x-data>
                        <label for="gross_income">Hrubý příjem:</label>
                        <input
                            type="text"
                            id="gross_income"
                            :placeholder="form_data_placeholder.gross_income"
                            x-model.debounce.500ms="form_data.gross_income"
                        />
                        <label for="deti">Počet dětí:</label>
                        <input
                            type="text"
                            id="deti"
                            :placeholder="form_data_placeholder.deti || '0'"
                            x-model.debounce.500ms="form_data.deti"
                        />
                        <label for="social_insurance"
                            >Sociální zabezpečení (musí vyplnit pouze OSVČ nebo
                            osoby nepobírající alespoň minimální mzdu):</label
                        >
                        <input
                            type="text"
                            id="social_insurance"
                            :placeholder="form_data_placeholder.social_insurance || '0'"
                            x-model.debounce.500ms="form_data.social_insurance"
                        />
                        <label
                            for="vat_books_music_medicine_water_accomodations"
                            >Vodné a stočné, knihy, hudba, léky, služby
                            ubytování:</label
                        >
                        <input
                            type="text"
                            id="vat_books_music_medicine_water_accomodations"
                            :placeholder="form_data_placeholder.vat_books_music_medicine_water_accomodations"
                            x-model.debounce.500ms="form_data.vat_books_music_medicine_water_accomodations"
                        />
                        <label for="vat_food_mhd_medical_devices"
                            >Potraviny a gastronomické služby, veřejná doprava,
                            léčební pomůcky:</label
                        >
                        <input
                            type="text"
                            id="vat_food_mhd_medical_devices"
                            :placeholder="form_data_placeholder.vat_food_mhd_medical_devices"
                            x-model.debounce.500ms="form_data.vat_food_mhd_medical_devices"
                        />
                        <label for="vat_21">Všechny ostatní útraty:</label>
                        <input
                            type="text"
                            id="vat_21"
                            :placeholder="form_data_placeholder.vat_21"
                            x-model.debounce.500ms="form_data.vat_21"
                        />
                        <label for="capital_gains">Kapitálové příjmy:</label>
                        <input
                            type="text"
                            id="capital_gains"
                            :placeholder="form_data_placeholder.capital_gains || '0'"
                            x-model.debounce.500ms="form_data.capital_gains"
                        />
                        <label for="gambling_tax"
                            >Prohrané částky v neúspěšném hazardu:</label
                        >
                        <input
                            type="text"
                            id="gambling_tax"
                            :placeholder="form_data_placeholder.gambling_tax"
                            x-model.debounce.500ms="form_data.gambling_tax"
                        />
                        <label for="consumer_tax_car_fuel">Palivo:</label>
                        <input
                            type="text"
                            id="consumer_tax_car_fuel"
                            :placeholder="form_data_placeholder.consumer_tax_car_fuel"
                            x-model.debounce.500ms="form_data.consumer_tax_car_fuel"
                        />
                        <label for="consumer_tax_beer"
                            >Počet vypitých litrů piva:</label
                        >
                        <input
                            type="text"
                            id="consumer_tax_beer"
                            :placeholder="form_data_placeholder.consumer_tax_beer"
                            x-model.debounce.500ms="form_data.consumer_tax_beer"
                        />
                        <label for="consumer_tax_tobacco"
                            >Počet krabiček cigaret:</label
                        >
                        <input
                            type="text"
                            id="consumer_tax_tobacco"
                            :placeholder="form_data_placeholder.consumer_tax_tobacco"
                            x-model.debounce.500ms="form_data.consumer_tax_tobacco"
                        />
                        <label for="consumer_tax_alcohol"
                            >Objem vypitého ethanolu obsaženého v
                            lihovinách:</label
                        >
                        <input
                            type="text"
                            id="consumer_tax_alcohol"
                            :placeholder="form_data_placeholder.consumer_tax_alcohol"
                            x-model.debounce.500ms="form_data.consumer_tax_alcohol"
                        />
                    </form>
                </article>
                <article class="prijmy" x-data>
                    <header>
                        <h4>Příjmy <span x-text="rok"></span></h4>
                    </header>
                    <table>
                        <tr>
                            <th></th>
                            <th>v mld. Kč</th>
                            <th>Váš podíl v&nbspKč</th>
                        </tr>
                        <tr>
                            <th>Celkem</th>
                            <td>
                                <span
                                    x-text="budget.total_income / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.celkove_odvody, false, true)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>DPH</th>
                            <td>
                                <span x-text="budget.vat / 1000000000"></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.podil_na_dph)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Spotřební daň celkem</th>
                            <td>
                                <span
                                    x-text="budget.consumer_taxes / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.spotrebni_dan_celkem)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Spotřební daň z paliv</th>
                            <td>
                                <span
                                    x-text="budget.consumer_tax_oils / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.spotrebni_dan_paliva)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Spotřební daň z tabáku</th>
                            <td>
                                <span
                                    x-text="budget.consumer_tax_tobacco / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.spotrebni_dan_tabak)"
                                ></span>
                            </td>
                        </tr>

                        <tr>
                            <th>Daň z příjmu fyzických osob</th>
                            <td>
                                <span
                                    x-text="budget.income_tax_individual / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.dan_z_prijmu, false, true)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Daň z příjmu právnických osob</th>
                            <td>
                                <span
                                    x-text="budget.income_tax_company / 1000000000"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Pojistné na sociální zabezpečení</th>
                            <td>
                                <span
                                    x-text="budget.mandatory_social_insurance / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.soc_pojistne)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Daň z hazardních her</th>
                            <td>
                                <span
                                    x-text="budget.gambling_tax / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.dan_hazard)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Poplatky za uložení odpadů</th>
                            <td>
                                <span
                                    x-text="budget.trash_fees / 1000000000"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Ostatní daňové příjmy</th>
                            <td>
                                <span
                                    x-text="budget.other_tax / 1000000000"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Příjmy z EU</th>
                            <td>
                                <span
                                    x-text="budget.income_from_eu / 1000000000"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Příjmy sdílené s EU</th>
                            <td>
                                <span
                                    x-text="budget.income_connected_with_eu / 1000000000"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Ostatní nedaňové příjmy</th>
                            <td>
                                <span
                                    x-text="budget.other_nontax_income / 1000000000"
                                ></span>
                            </td>
                        </tr>
                    </table>
                </article>
                <article class="vydaje" x-data>
                    <header>
                        <h4>Výdaje <span x-text="rok"></span></h4>
                    </header>
                    <table>
                        <tr>
                            <th></th>
                            <th>v mld. Kč</th>
                            <th>Váš podíl v Kč</th>
                        </tr>
                        <tr>
                            <th>Celkem</th>
                            <td>
                                <span
                                    x-text="expenses.total_expenses / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.podil_na_vydajich)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Platy</th>
                            <td>
                                <span
                                    x-text="expenses.salaries / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.podil_na_platech)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Neinvestiční nákupy</th>
                            <td>
                                <span
                                    x-text="expenses.noninvestment_purchases / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.neinvesticni_nakupy)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Neinvestiční transfery podnikatelům</th>
                            <td>
                                <span
                                    x-text="expenses.noninvestment_bussines / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.neinvesticni_transfery_pod)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                Neinvestiční transfery neziskovým organizacím
                            </th>
                            <td>
                                <span
                                    x-text="expenses.noninvestment_non_profit / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.neinvesticni_transfery_nezisk)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Neinvestiční transfery státním fondům</th>
                            <td>
                                <span
                                    x-text="expenses.noninvestment_state_funds / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.neinvesticni_transfery_fondum)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                Neinvestiční transfery fondům sociálního a
                                zdravotního pojištění
                            </th>
                            <td>
                                <span
                                    x-text="expenses.noninvestment_soc_and_health_funds / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.neinvesticni_transfery_soc_a_zdrav)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                Neinvestiční transfery rozpočtům územní úrovně
                            </th>
                            <td>
                                <span
                                    x-text="expenses.noninvestment_regions / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.neinvesticni_transfery_rozpoctum)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                Neinvestiční transfery příspěvkovým organizacím
                            </th>
                            <td>
                                <span
                                    x-text="expenses.noninvestment_contribution / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.neinvesticni_transfery_pris)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Důchody</th>
                            <td>
                                <span
                                    x-text="expenses.pensions / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.podil_na_duchodech)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Podpora v nezaměstnanosti</th>
                            <td>
                                <span
                                    x-text="expenses.unemployment_help / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.podpora_v_nezamestnanosti)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Ostatní sociální dávky</th>
                            <td>
                                <span
                                    x-text="expenses.other_social_help / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.ostatni_socialni_davky)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Státní sociální podpora</th>
                            <td>
                                <span
                                    x-text="expenses.state_social_help / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.statni_socialni_podpora)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Stavební spoření</th>
                            <td>
                                <span
                                    x-text="expenses.building_savings / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.stavebni_sporeni)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Státní příspěvěk na důchodové připojištění</th>
                            <td>
                                <span
                                    x-text="expenses.pension_insurance_contribution / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.duchodove_pripojisteni)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Odvody do rozpočtu EU</th>
                            <td>
                                <span
                                    x-text="expenses.eu_payment / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.platby_eu)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Ostatní běžné výdaje</th>
                            <td>
                                <span
                                    x-text="expenses.other_usual_expenses / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.ostatni_bezne_vydaje)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Investiční nákupy</th>
                            <td>
                                <span
                                    x-text="expenses.investment_purchases / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.investicni_nakupy)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Investiční transfery podnikatelům</th>
                            <td>
                                <span
                                    x-text="expenses.investment_transfers_bussines / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.investicni_transfery_pod)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Investiční transfery státním fondům</th>
                            <td>
                                <span
                                    x-text="expenses.investment_state_funds / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.investicni_transfery_fondum)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                Investiční transfery rozpočtům územní úrovně
                            </th>
                            <td>
                                <span
                                    x-text="expenses.investment_regions / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.investicni_transfery_rozpoctum)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                Investiční transfery příspěvkovým organizacím
                            </th>
                            <td>
                                <span
                                    x-text="expenses.investment_contribution / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.investicni_transfery_pris)"
                                ></span>
                            </td>
                        </tr>
                        <tr>
                            <th>Ostatní investice</th>
                            <td>
                                <span
                                    x-text="expenses.other_investment / 1000000000"
                                ></span>
                            </td>
                            <td>
                                <span
                                    x-text="display_number(vysledky.ostatni_investice)"
                                ></span>
                            </td>
                        </tr>
                    </table>
                </article>
            </section>
            <section x-show="is_logged">
                <article>
                    <header>
                        <h4>Přidání vlastní investice</h4>
                    </header>
                    <form
                        x-data="{ start_year: (new Date().getFullYear()), cost: 0,  name: '' }"
                    >
                        <label for="nazev">Název investice</label>
                        <input type="text" id="nazev" x-model="name" />
                        <label for="cena"
                            >Celkové náklady investice (v mld. Kč)</label
                        >
                        <input type="text" id="cena" x-model="cost" />
                        <label for="rok_pocatku">Rok počátku realizace</label>
                        <input
                            type="text"
                            id="rok_pocatku"
                            x-model="start_year"
                        />
                        <button
                            x-on:click.prevent="
                              if (is_logged && !is_admin) {
                                  let new_investment = await add_user_investment(client, { start_year: start_year, cost: cost * 1000000000, name: name });
                                  extra_investice.push(new_investment);
                              } else {
                                  zaznamy.push(await add_investment(client, { start_year: start_year, cost: cost * 1000000000, name: name }));
                              }

                              start_year = (new Date().getFullYear());
                              cost = 0;
                              name = '';
                            "
                        >
                            Přidat
                        </button>
                    </form>
                </article>
            </section>
            <section x-data>
                <input
                    type="search"
                    id="search"
                    name="search"
                    placeholder="Filtrovat investice"
                    x-model="filtr"
                />
            </section>
            <section
                class="flexperiment"
                x-data="{ investice_total: 0 }"
                x-init="
                investice_total = budget.investment_purchases
                  + expenses.investment_transfers_bussines
                  + expenses.investment_state_funds
                  + expenses.investment_regions
                  + expenses.investment_contribution
                  + expenses.other_investment;
            "
                x-effect="
                investice_total = expenses.investment_purchases
                  + expenses.investment_transfers_bussines
                  + expenses.investment_state_funds
                  + expenses.investment_regions
                  + expenses.investment_contribution
                  + expenses.other_investment;
            "
            >
                <template
                    x-for="data in filter_investment_array(extra_investice, filtr).concat(zaznamy)"
                    x-effect="zaznamy = (await fetch_investice(filtr, []))"
                >
                    <article class="expense-display">
                        <header x-text="data.name"></header>
                        <div>
                            <article class="expense-stat rok">
                                <header>Rok</header>
                                <div
                                    style="
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                    "
                                >
                                    <span x-text="data.start_year"></span>
                                </div>
                            </article>
                            <article class="expense-stat cena">
                                <header>Náklady mld. Kč</header>
                                <div
                                    style="
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                    "
                                >
                                    <span
                                        x-text="(data.cost / 1000000000).toFixed(2)"
                                    ></span>
                                </div>
                            </article>
                            <article class="expense-stat podil_procento">
                                <header>Podíl rozpočtu</header>
                                <div
                                    style="
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                    "
                                >
                                    <span
                                        x-text="((data.cost / investice_total) * 100).toFixed(2)"
                                    ></span
                                    ><span>%</span>
                                </div>
                            </article>
                            <article class="expense-stat podil_kc">
                                <header>Váš podíl (Kč)</header>
                                <div
                                    style="
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                    "
                                >
                                    <span
                                        x-text="Math.max(((data.cost * vysledky.procentualni_podil_investice) / 100).toFixed(2), 0)"
                                    ></span>
                                </div>
                            </article>
                        </div>
                        <template x-if="data.user_id || is_admin">
                            <a
                                href="#"
                                role="button"
                                x-on:click.prevent="
                                    if (!is_admin) {
                                        await remove_user_investment(client, data.id);
                                        remove_first_match(extra_investice, item => item.id == data.id);
                                    } else {
                                        console.log(data);
                                        await remove_investment(client, data.id);
                                        remove_first_match(zaznamy, item => item.id == data.id);
                                    }
                                "
                                style="margin-top: 1em"
                                >Odebrat</a
                            >
                        </template>
                    </article>
                </template>
            </section>
        </main>
        <footer>
            Tomáš Hozda © <span x-text="new Date().getFullYear()"></span>
        </footer>
    </body>
</html>
