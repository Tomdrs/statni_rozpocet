<!DOCTYPE html>
<html data-theme="light">
    <head>
        <!-- External libraries -->
        <script
            defer
            src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
        ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pocketbase/0.12.0/pocketbase.umd.js"></script>

        <!-- Application scripts -->
        <script src="/static/utils.js"></script>
        <script src="/static/pb.js"></script>
        <script src="/static/flask_api.js"></script>
        <script src="/static/pb_api.js"></script>
        <link
            rel="stylesheet"
            href="https://unpkg.com/@picocss/pico@1.*/css/pico.min.css"
        />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body x-init="console.log('start alpinejs')">
        <main
            x-data="{ tab: 'login', client: {} }"
            x-init="client = pb_client(); console.log(client)"
        >
            <section
                style="
                    display: flex;
                    align-items: center;
                    justify-content: center;
                "
            >
                <article style="width: 600px">
                    <header>
                        <div class="vyber-rok">
                            <input
                                x-model="tab"
                                type="radio"
                                value="login"
                                id="login-select"
                                checked="true"
                            /><label
                                for="login-select"
                                style="font-size: 1em; font-weight: bold"
                                >Přihlášení</label
                            >
                            <input
                                x-model="tab"
                                type="radio"
                                value="signup"
                                id="signup-select"
                            /><label
                                for="signup-select"
                                style="font-size: 1em; font-weight: bold"
                                >Registrace</label
                            >
                        </div>
                    </header>
                    <template x-if="tab == 'login'">
                        <form
                            x-data="{ email: '', pass: '', login_status: {} }"
                        >
                            <label for="email-login">Email</label>
                            <input x-model="email" type="text" id="username" />
                            <label for="password-login">Heslo</label>
                            <input
                                x-model="pass"
                                type="password"
                                id="password-login"
                            />
                            <input
                                type="submit"
                                value="Přihlásit"
                                :disabled="login_status == 'success'"
                                x-on:click.prevent="login_status = (await pb_login(client, email, pass)); console.log('bruh', login_status)"
                            />
                            <p
                                x-show="login_status == 'success'"
                                class="ok-status"
                            >
                                Přihlášení proběhlo úspěšně, přesměrování na
                                hlavní stránku...
                            </p>
                            <p
                                x-show="login_status == 'error'"
                                class="error-status"
                            >
                                Přihlášení bylo neúspěšné, zkontrolujte údaje.
                            </p>
                        </form>
                    </template>
                    <template x-if="tab == 'signup'">
                        <form
                            x-data="{ email: '', pass: '', pass_again: '', signup_status: '' }"
                        >
                            <label for="email-signup">Email</label>
                            <input
                                x-model="email"
                                type="text"
                                id="email-signup"
                            />
                            <label for="password-signup">Heslo</label>
                            <input
                                x-model="pass"
                                type="password"
                                id="password-signup"
                            />
                            <p x-show="pass.length < 8" class="error-status">
                                Hesla musí mít 8-72 znaků.
                            </p>
                            <label for="password-signup-again"
                                >Heslo znovu</label
                            >
                            <input
                                x-model="pass_again"
                                type="password"
                                id="password-signup-again"
                            />
                            <p x-show="pass != pass_again" class="error-status">
                                Hesla se nerovnají
                            </p>
                            <input
                                type="submit"
                                value="Registrovat"
                                :disabled="pass != pass_again || pass.length < 8"
                                x-on:click.prevent="signup_status = (await pb_signup(client, email, pass, pass_again)); console.log('status', signup_status)"
                            />
                            <p
                                class="error-status"
                                x-show="signup_status !== 'success' && signup_status !== ''"
                            >
                                Registrace se nepodařila, zkontrolujte údaje
                            </p>
                            <p
                                class="ok-status"
                                x-show="signup_status === 'success'"
                            >
                                Registrace byla úspěšná, přesměrování na login
                            </p>

                        </form>
                    </template>
                </article>
            </section>
        </main>
        <footer>
            Tomáš Hozda © <span x-text="new Date().getFullYear()"></span>
        </footer>
    </body>
</html>
